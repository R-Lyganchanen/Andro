<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>App — Код</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="App">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  <!-- Подключаем твой основной стиль -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app form-screen page2">
  <div class="app passcode">
    <div class="passcode__header">Код для входу</div>

    <!-- Индикатор (4 точки) -->
    <div class="dots">
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>

    <!-- Цифровая клавиатура -->
    <div class="keypad">
      <button data-key="1">1</button>
      <button data-key="2">2</button>
      <button data-key="3">3</button>
      <button data-key="4">4</button>
      <button data-key="5">5</button>
      <button data-key="6">6</button>
      <button data-key="7">7</button>
      <button data-key="8">8</button>
      <button data-key="9">9</button>
      <button class="empty" disabled></button>
      <button data-key="0">0</button>
      <button class="backspace" data-key="back">×</button>
    </div>

    <div class="passcode__footer">Не пам’ятаю код для входу</div>
  </div>
</div>

<!-- Основная логика -->
<script>
(function () {
  const CORRECT = '1234';
  const REDIRECT = 'page3.html';

  let input = '';
  let locked = false;

  const dots = Array.from(document.querySelectorAll('.dots .dot'));
  const keypad = document.querySelector('.keypad');

  function renderDots(len) {
    dots.forEach((d, i) => d.classList.toggle('filled', i < len));
  }

  function resetImmediate() {
    input = '';
    renderDots(0);
    locked = false;
  }

  function resetSoft(delay = 250) {
    locked = true;
    setTimeout(resetImmediate, delay);
  }

  function handleDigit(key) {
    if (locked) return;
    if (input.length >= 4) return;

    input += key;
    renderDots(input.length);

    if (input.length === 4) {
      if (input === CORRECT) {
        locked = true;
        location.href = REDIRECT;
      } else {
        resetSoft(250);
      }
    }
  }

  function handleBackspace() {
    if (locked) return;
    if (input.length === 0) return;
    input = input.slice(0, -1);
    renderDots(input.length);
  }

  function routeKey(key) {
    if (key === 'back') return handleBackspace();
    if (/^\d$/.test(key)) return handleDigit(key);
  }

  keypad.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn || btn.disabled) return;
    routeKey(btn.dataset.key);
  });

  keypad.addEventListener('touchstart', (e) => {
    const btn = e.target.closest('button');
    if (!btn || btn.disabled) return;
    routeKey(btn.dataset.key);
    e.preventDefault();
  }, { passive: false });

  renderDots(0);
})();
</script>

<!-- Остальные твои скрипты -->
<script src="db.js"></script>
<script src="app.js"></script>
<script src="script.js" defer></script>
</body>
</html>
